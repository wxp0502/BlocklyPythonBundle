!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).loadPyodide={})}(this,(function(e){"use strict";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var t={exports:{}},r={exports:{}};!function(e,t){e.exports=function(){function e(e){return e.charAt(0).toUpperCase()+e.substring(1)}function t(e){return function(){return this[e]}}var r=["isConstructor","isEval","isNative","isToplevel"],i=["columnNumber","lineNumber"],n=["fileName","functionName","source"],o=r.concat(i,n,["args"],["evalOrigin"]);function a(t){if(t)for(var r=0;r<o.length;r++)void 0!==t[o[r]]&&this["set"+e(o[r])](t[o[r]])}a.prototype={getArgs:function(){return this.args},setArgs:function(e){if("[object Array]"!==Object.prototype.toString.call(e))throw new TypeError("Args must be an Array");this.args=e},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(e){if(e instanceof a)this.evalOrigin=e;else{if(!(e instanceof Object))throw new TypeError("Eval Origin must be an Object or StackFrame");this.evalOrigin=new a(e)}},toString:function(){var e=this.getFileName()||"",t=this.getLineNumber()||"",r=this.getColumnNumber()||"",i=this.getFunctionName()||"";return this.getIsEval()?e?"[eval] ("+e+":"+t+":"+r+")":"[eval]:"+t+":"+r:i?i+" ("+e+":"+t+":"+r+")":e+":"+t+":"+r}},a.fromString=function(e){var t=e.indexOf("("),r=e.lastIndexOf(")"),i=e.substring(0,t),n=e.substring(t+1,r).split(","),o=e.substring(r+1);if(0===o.indexOf("@"))var s=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(o,""),l=s[1],c=s[2],d=s[3];return new a({functionName:i,args:n||void 0,fileName:l,lineNumber:c||void 0,columnNumber:d||void 0})};for(var s=0;s<r.length;s++)a.prototype["get"+e(r[s])]=t(r[s]),a.prototype["set"+e(r[s])]=function(e){return function(t){this[e]=Boolean(t)}}(r[s]);for(var l=0;l<i.length;l++)a.prototype["get"+e(i[l])]=t(i[l]),a.prototype["set"+e(i[l])]=function(e){return function(t){if(r=t,isNaN(parseFloat(r))||!isFinite(r))throw new TypeError(e+" must be a Number");var r;this[e]=Number(t)}}(i[l]);for(var c=0;c<n.length;c++)a.prototype["get"+e(n[c])]=t(n[c]),a.prototype["set"+e(n[c])]=function(e){return function(t){this[e]=String(t)}}(n[c]);return a}()}(r),function(e,t){var i,n,o,a;e.exports=(i=r.exports,n=/(^|@)\S+:\d+/,o=/^\s*at .*(\S+:\d+|\(native\))/m,a=/^(eval@)?(\[native code])?$/,{parse:function(e){if(void 0!==e.stacktrace||void 0!==e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(o))return this.parseV8OrIE(e);if(e.stack)return this.parseFFOrSafari(e);throw new Error("Cannot parse given Error object")},extractLocation:function(e){if(-1===e.indexOf(":"))return[e];var t=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(e.replace(/[()]/g,""));return[t[1],t[2]||void 0,t[3]||void 0]},parseV8OrIE:function(e){return e.stack.split("\n").filter((function(e){return!!e.match(o)}),this).map((function(e){e.indexOf("(eval ")>-1&&(e=e.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var t=e.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),r=t.match(/ (\(.+\)$)/);t=r?t.replace(r[0],""):t;var n=this.extractLocation(r?r[1]:t),o=r&&t||void 0,a=["eval","<anonymous>"].indexOf(n[0])>-1?void 0:n[0];return new i({functionName:o,fileName:a,lineNumber:n[1],columnNumber:n[2],source:e})}),this)},parseFFOrSafari:function(e){return e.stack.split("\n").filter((function(e){return!e.match(a)}),this).map((function(e){if(e.indexOf(" > eval")>-1&&(e=e.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),-1===e.indexOf("@")&&-1===e.indexOf(":"))return new i({functionName:e});var t=/((.*".+"[^@]*)?[^@]*)(?:@)/,r=e.match(t),n=r&&r[1]?r[1]:void 0,o=this.extractLocation(e.replace(t,""));return new i({functionName:n,fileName:o[0],lineNumber:o[1],columnNumber:o[2],source:e})}),this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(e){for(var t=/Line (\d+).*script (?:in )?(\S+)/i,r=e.message.split("\n"),n=[],o=2,a=r.length;o<a;o+=2){var s=t.exec(r[o]);s&&n.push(new i({fileName:s[2],lineNumber:s[1],source:r[o]}))}return n},parseOpera10:function(e){for(var t=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=e.stacktrace.split("\n"),n=[],o=0,a=r.length;o<a;o+=2){var s=t.exec(r[o]);s&&n.push(new i({functionName:s[3]||void 0,fileName:s[2],lineNumber:s[1],source:r[o]}))}return n},parseOpera11:function(e){return e.stack.split("\n").filter((function(e){return!!e.match(n)&&!e.match(/^Error created at/)}),this).map((function(e){var t,r=e.split("@"),n=this.extractLocation(r.pop()),o=r.shift()||"",a=o.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;o.match(/\(([^)]*)\)/)&&(t=o.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var s=void 0===t||"[arguments not available]"===t?void 0:t.split(",");return new i({functionName:a,args:s,fileName:n[0],lineNumber:n[1],columnNumber:n[2],source:e})}),this)}})}(t);var i=t.exports;const n="undefined"!=typeof process&&process.release&&"node"===process.release.name&&void 0===process.browser;let o,a,s,l,c,d,u,p,f;if(d=n?function(e,t){return s.resolve(t||".",e)}:function(e,t){return void 0===t&&(t=location),new URL(e,t).toString()},n||(u="/"),p=n?async function(e,t){if(e.startsWith("file://")&&(e=e.slice("file://".length)),e.includes("://")){let t=await a(e);if(!t.ok)throw new Error(`Failed to load '${e}': request failed.`);return new Uint8Array(await t.arrayBuffer())}{const t=await c.readFile(e);return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}}:async function(e,t){const r=new URL(e,location);let i=t?{integrity:t}:{},n=await fetch(r,i);if(!n.ok)throw new Error(`Failed to load '${r}': request failed.`);return new Uint8Array(await n.arrayBuffer())},globalThis.document)f=async e=>await import(e);else if(globalThis.importScripts)f=async e=>{try{globalThis.importScripts(e)}catch(t){if(!(t instanceof TypeError))throw t;await import(e)}};else{if(!n)throw new Error("Cannot determine runtime environment");f=async function(e){e.startsWith("file://")&&(e=e.slice("file://".length)),e.includes("://")?l.runInThisContext(await(await a(e)).text()):await import(o.pathToFileURL(e).href)}}async function h(e={}){await async function(){if(!n)return;if(o=(await import("url")).default,c=await import("fs/promises"),a=globalThis.fetch?fetch:(await import("node-fetch")).default,l=(await import("vm")).default,s=await import("path"),u=s.sep,"undefined"!=typeof require)return;const e={fs:await import("fs"),crypto:await import("crypto"),ws:await import("ws"),child_process:await import("child_process")};globalThis.require=function(t){return e[t]}}();let t=e.indexURL||function(){if("string"==typeof __dirname)return __dirname;let e;try{throw new Error}catch(t){e=t}let t=i.parse(e)[0].fileName;const r=t.lastIndexOf(u);if(-1===r)throw new Error("Could not extract indexURL path from pyodide module location");return t.slice(0,r)}();t=d(t),t.endsWith("/")||(t+="/"),e.indexURL=t;const r={fullStdLib:!0,jsglobals:globalThis,stdin:globalThis.prompt?globalThis.prompt:void 0,homedir:"/home/pyodide",lockFileURL:t+"repodata.json"},h=Object.assign(r,e),m=p(h.indexURL+"pyodide_py.tar"),y={noImageDecoding:!0,noAudioDecoding:!0,noWasmDecoding:!1,preloadedWasm:{},preRun:[]},g={config:h};y.API=g,function(e,t,r,i){r&&(e.print=r),i&&(e.printErr=i),t&&e.preRun.push((function(){e.FS.init(function(e){const t=new TextEncoder;let r=new Uint8Array(0),i=-1;return function(){try{if(-1===i){let n=e();if(null==n)return null;if("string"!=typeof n)throw new TypeError(`Expected stdin to return string, null, or undefined, got type ${typeof n}.`);n.endsWith("\n")||(n+="\n"),r=t.encode(n),i=0}if(i<r.length){let e=r[i];return i++,e}return i=-1,null}catch(e){throw console.error("Error thrown in stdin:"),console.error(e),e}}}(t),null,null)}))}(y,h.stdin,h.stdout,h.stderr),function(e,t){e.preRun.push((function(){try{e.FS.mkdirTree(t)}catch(e){console.error(`Error occurred while making a home directory '${t}':`),console.error(e),console.error("Using '/' for a home directory instead"),t="/"}e.ENV.HOME=t,e.FS.chdir(t)}))}(y,h.homedir);const v=new Promise((e=>y.postRun=e));y.locateFile=e=>h.indexURL+e;const w=`${h.indexURL}pyodide.asm.js`;if(await f(w),await _createPyodideModule(y),await v,"0.21.3"!==g.version)throw new Error(`Pyodide version does not match: '0.21.3' <==> '${g.version}'. If you updated the Pyodide version, make sure you also updated the 'indexURL' parameter passed to loadPyodide.`);y.locateFile=e=>{throw new Error("Didn't expect to load any more file_packager files!")};const b=await m;!function(e,t){let r=e.FS.open("/pyodide_py.tar","w");e.FS.write(r,t,0,t.byteLength,void 0,!0),e.FS.close(r);const i=e.stringToNewUTF8('\nfrom sys import version_info\npyversion = f"python{version_info.major}.{version_info.minor}"\nimport shutil\nshutil.unpack_archive("/pyodide_py.tar", f"/lib/{pyversion}/site-packages/")\ndel shutil\nimport importlib\nimportlib.invalidate_caches()\ndel importlib\n    ');if(e._PyRun_SimpleString(i))throw new Error("OOPS!");e._free(i),e.FS.unlink("/pyodide_py.tar")}(y,b),y._pyodide_init();const _=function(e,t){e.runPythonInternal_dict=e._pyodide._base.eval_code("{}"),e.importlib=e.runPythonInternal("import importlib; importlib");let r=e.importlib.import_module;e.sys=r("sys"),e.sys.path.insert(0,t.homedir);let i=e.runPythonInternal("import __main__; __main__.__dict__"),n=e.runPythonInternal("import builtins; builtins.__dict__");var o;e.globals=(o=n,new Proxy(i,{get:(e,t)=>"get"===t?t=>{let r=e.get(t);return void 0===r&&(r=o.get(t)),r}:"has"===t?t=>e.has(t)||o.has(t):Reflect.get(e,t)}));let a=e._pyodide._importhook;a.register_js_finder(),a.register_js_module("js",t.jsglobals),a.register_unvendored_stdlib_finder();let s=e.makePublicAPI();return a.register_js_module("pyodide_js",s),e.pyodide_py=r("pyodide"),e.pyodide_code=r("pyodide.code"),e.pyodide_ffi=r("pyodide.ffi"),e.package_loader=r("pyodide._package_loader"),s.pyodide_py=e.pyodide_py,s.globals=e.globals,s}(g,h);if(_.version.includes("dev")||g.setCdnUrl(`https://cdn.jsdelivr.net/pyodide/v${_.version}/full/`),await g.packageIndexReady,"0.21.3"!==g.repodata_info.version)throw new Error("Lock file version doesn't match Pyodide version");return h.fullStdLib&&await _.loadPackage(["distutils"]),_.runPython("print('Python initialization complete')"),_}globalThis.loadPyodide=h,e.loadPyodide=h,e.version="0.21.3",Object.defineProperty(e,"__esModule",{value:!0})}));