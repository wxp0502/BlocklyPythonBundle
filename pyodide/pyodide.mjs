"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var e,t,r,i,n={exports:{}};n.exports=function(){function e(e){return e.charAt(0).toUpperCase()+e.substring(1)}function t(e){return function(){return this[e]}}var r=["isConstructor","isEval","isNative","isToplevel"],i=["columnNumber","lineNumber"],n=["fileName","functionName","source"],o=r.concat(i,n,["args"],["evalOrigin"]);function a(t){if(t)for(var r=0;r<o.length;r++)void 0!==t[o[r]]&&this["set"+e(o[r])](t[o[r]])}a.prototype={getArgs:function(){return this.args},setArgs:function(e){if("[object Array]"!==Object.prototype.toString.call(e))throw new TypeError("Args must be an Array");this.args=e},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(e){if(e instanceof a)this.evalOrigin=e;else{if(!(e instanceof Object))throw new TypeError("Eval Origin must be an Object or StackFrame");this.evalOrigin=new a(e)}},toString:function(){var e=this.getFileName()||"",t=this.getLineNumber()||"",r=this.getColumnNumber()||"",i=this.getFunctionName()||"";return this.getIsEval()?e?"[eval] ("+e+":"+t+":"+r+")":"[eval]:"+t+":"+r:i?i+" ("+e+":"+t+":"+r+")":e+":"+t+":"+r}},a.fromString=function(e){var t=e.indexOf("("),r=e.lastIndexOf(")"),i=e.substring(0,t),n=e.substring(t+1,r).split(","),o=e.substring(r+1);if(0===o.indexOf("@"))var s=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(o,""),l=s[1],c=s[2],u=s[3];return new a({functionName:i,args:n||void 0,fileName:l,lineNumber:c||void 0,columnNumber:u||void 0})};for(var s=0;s<r.length;s++)a.prototype["get"+e(r[s])]=t(r[s]),a.prototype["set"+e(r[s])]=function(e){return function(t){this[e]=Boolean(t)}}(r[s]);for(var l=0;l<i.length;l++)a.prototype["get"+e(i[l])]=t(i[l]),a.prototype["set"+e(i[l])]=function(e){return function(t){if(r=t,isNaN(parseFloat(r))||!isFinite(r))throw new TypeError(e+" must be a Number");var r;this[e]=Number(t)}}(i[l]);for(var c=0;c<n.length;c++)a.prototype["get"+e(n[c])]=t(n[c]),a.prototype["set"+e(n[c])]=function(e){return function(t){this[e]=String(t)}}(n[c]);return a}();var o={exports:{}}.exports=(e=n.exports,t=/(^|@)\S+:\d+/,r=/^\s*at .*(\S+:\d+|\(native\))/m,i=/^(eval@)?(\[native code])?$/,{parse:function(e){if(void 0!==e.stacktrace||void 0!==e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(r))return this.parseV8OrIE(e);if(e.stack)return this.parseFFOrSafari(e);throw new Error("Cannot parse given Error object")},extractLocation:function(e){if(-1===e.indexOf(":"))return[e];var t=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(e.replace(/[()]/g,""));return[t[1],t[2]||void 0,t[3]||void 0]},parseV8OrIE:function(t){return t.stack.split("\n").filter((function(e){return!!e.match(r)}),this).map((function(t){t.indexOf("(eval ")>-1&&(t=t.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var r=t.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),i=r.match(/ (\(.+\)$)/);r=i?r.replace(i[0],""):r;var n=this.extractLocation(i?i[1]:r),o=i&&r||void 0,a=["eval","<anonymous>"].indexOf(n[0])>-1?void 0:n[0];return new e({functionName:o,fileName:a,lineNumber:n[1],columnNumber:n[2],source:t})}),this)},parseFFOrSafari:function(t){return t.stack.split("\n").filter((function(e){return!e.match(i)}),this).map((function(t){if(t.indexOf(" > eval")>-1&&(t=t.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),-1===t.indexOf("@")&&-1===t.indexOf(":"))return new e({functionName:t});var r=/((.*".+"[^@]*)?[^@]*)(?:@)/,i=t.match(r),n=i&&i[1]?i[1]:void 0,o=this.extractLocation(t.replace(r,""));return new e({functionName:n,fileName:o[0],lineNumber:o[1],columnNumber:o[2],source:t})}),this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(t){for(var r=/Line (\d+).*script (?:in )?(\S+)/i,i=t.message.split("\n"),n=[],o=2,a=i.length;o<a;o+=2){var s=r.exec(i[o]);s&&n.push(new e({fileName:s[2],lineNumber:s[1],source:i[o]}))}return n},parseOpera10:function(t){for(var r=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,i=t.stacktrace.split("\n"),n=[],o=0,a=i.length;o<a;o+=2){var s=r.exec(i[o]);s&&n.push(new e({functionName:s[3]||void 0,fileName:s[2],lineNumber:s[1],source:i[o]}))}return n},parseOpera11:function(r){return r.stack.split("\n").filter((function(e){return!!e.match(t)&&!e.match(/^Error created at/)}),this).map((function(t){var r,i=t.split("@"),n=this.extractLocation(i.pop()),o=i.shift()||"",a=o.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;o.match(/\(([^)]*)\)/)&&(r=o.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var s=void 0===r||"[arguments not available]"===r?void 0:r.split(",");return new e({functionName:a,args:s,fileName:n[0],lineNumber:n[1],columnNumber:n[2],source:t})}),this)}});const a="undefined"!=typeof process&&process.release&&"node"===process.release.name&&void 0===process.browser;let s,l,c,u,d,p,f,h,m;if(p=a?function(e,t){return c.resolve(t||".",e)}:function(e,t){return void 0===t&&(t=location),new URL(e,t).toString()},a||(f="/"),h=a?async function(e,t){if(e.startsWith("file://")&&(e=e.slice("file://".length)),e.includes("://")){let t=await l(e);if(!t.ok)throw new Error(`Failed to load '${e}': request failed.`);return new Uint8Array(await t.arrayBuffer())}{const t=await d.readFile(e);return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}}:async function(e,t){const r=new URL(e,location);let i=t?{integrity:t}:{},n=await fetch(r,i);if(!n.ok)throw new Error(`Failed to load '${r}': request failed.`);return new Uint8Array(await n.arrayBuffer())},globalThis.document)m=async e=>await import(e);else if(globalThis.importScripts)m=async e=>{try{globalThis.importScripts(e)}catch(t){if(!(t instanceof TypeError))throw t;await import(e)}};else{if(!a)throw new Error("Cannot determine runtime environment");m=async function(e){e.startsWith("file://")&&(e=e.slice("file://".length)),e.includes("://")?u.runInThisContext(await(await l(e)).text()):await import(s.pathToFileURL(e).href)}}const g="0.21.3";async function y(e={}){await async function(){if(!a)return;if(s=(await import("url")).default,d=await import("fs/promises"),l=globalThis.fetch?fetch:(await import("node-fetch")).default,u=(await import("vm")).default,c=await import("path"),f=c.sep,"undefined"!=typeof require)return;const e={fs:await import("fs"),crypto:await import("crypto"),ws:await import("ws"),child_process:await import("child_process")};globalThis.require=function(t){return e[t]}}();let t=e.indexURL||function(){if("string"==typeof __dirname)return __dirname;let e;try{throw new Error}catch(t){e=t}let t=o.parse(e)[0].fileName;const r=t.lastIndexOf(f);if(-1===r)throw new Error("Could not extract indexURL path from pyodide module location");return t.slice(0,r)}();t=p(t),t.endsWith("/")||(t+="/"),e.indexURL=t;const r={fullStdLib:!0,jsglobals:globalThis,stdin:globalThis.prompt?globalThis.prompt:void 0,homedir:"/home/pyodide",lockFileURL:t+"repodata.json"},i=Object.assign(r,e),n=h(i.indexURL+"pyodide_py.tar"),g={noImageDecoding:!0,noAudioDecoding:!0,noWasmDecoding:!1,preloadedWasm:{},preRun:[]},y={config:i};g.API=y,function(e,t,r,i){r&&(e.print=r),i&&(e.printErr=i),t&&e.preRun.push((function(){e.FS.init(function(e){const t=new TextEncoder;let r=new Uint8Array(0),i=-1;return function(){try{if(-1===i){let n=e();if(null==n)return null;if("string"!=typeof n)throw new TypeError(`Expected stdin to return string, null, or undefined, got type ${typeof n}.`);n.endsWith("\n")||(n+="\n"),r=t.encode(n),i=0}if(i<r.length){let e=r[i];return i++,e}return i=-1,null}catch(e){throw console.error("Error thrown in stdin:"),console.error(e),e}}}(t),null,null)}))}(g,i.stdin,i.stdout,i.stderr),function(e,t){e.preRun.push((function(){try{e.FS.mkdirTree(t)}catch(e){console.error(`Error occurred while making a home directory '${t}':`),console.error(e),console.error("Using '/' for a home directory instead"),t="/"}e.ENV.HOME=t,e.FS.chdir(t)}))}(g,i.homedir);const v=new Promise((e=>g.postRun=e));g.locateFile=e=>i.indexURL+e;const w=`${i.indexURL}pyodide.asm.js`;if(await m(w),await _createPyodideModule(g),await v,"0.21.3"!==y.version)throw new Error(`Pyodide version does not match: '0.21.3' <==> '${y.version}'. If you updated the Pyodide version, make sure you also updated the 'indexURL' parameter passed to loadPyodide.`);g.locateFile=e=>{throw new Error("Didn't expect to load any more file_packager files!")};const b=await n;!function(e,t){let r=e.FS.open("/pyodide_py.tar","w");e.FS.write(r,t,0,t.byteLength,void 0,!0),e.FS.close(r);const i=e.stringToNewUTF8('\nfrom sys import version_info\npyversion = f"python{version_info.major}.{version_info.minor}"\nimport shutil\nshutil.unpack_archive("/pyodide_py.tar", f"/lib/{pyversion}/site-packages/")\ndel shutil\nimport importlib\nimportlib.invalidate_caches()\ndel importlib\n    ');if(e._PyRun_SimpleString(i))throw new Error("OOPS!");e._free(i),e.FS.unlink("/pyodide_py.tar")}(g,b),g._pyodide_init();const _=function(e,t){e.runPythonInternal_dict=e._pyodide._base.eval_code("{}"),e.importlib=e.runPythonInternal("import importlib; importlib");let r=e.importlib.import_module;e.sys=r("sys"),e.sys.path.insert(0,t.homedir);let i=e.runPythonInternal("import __main__; __main__.__dict__"),n=e.runPythonInternal("import builtins; builtins.__dict__");var o;e.globals=(o=n,new Proxy(i,{get:(e,t)=>"get"===t?t=>{let r=e.get(t);return void 0===r&&(r=o.get(t)),r}:"has"===t?t=>e.has(t)||o.has(t):Reflect.get(e,t)}));let a=e._pyodide._importhook;a.register_js_finder(),a.register_js_module("js",t.jsglobals),a.register_unvendored_stdlib_finder();let s=e.makePublicAPI();return a.register_js_module("pyodide_js",s),e.pyodide_py=r("pyodide"),e.pyodide_code=r("pyodide.code"),e.pyodide_ffi=r("pyodide.ffi"),e.package_loader=r("pyodide._package_loader"),s.pyodide_py=e.pyodide_py,s.globals=e.globals,s}(y,i);if(_.version.includes("dev")||y.setCdnUrl(`https://cdn.jsdelivr.net/pyodide/v${_.version}/full/`),await y.packageIndexReady,"0.21.3"!==y.repodata_info.version)throw new Error("Lock file version doesn't match Pyodide version");return i.fullStdLib&&await _.loadPackage(["distutils"]),_.runPython("print('Python initialization complete')"),_}export{y as loadPyodide,g as version};